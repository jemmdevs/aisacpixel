---
interface Props {
    href?: string;
    label: string;
    class?: string;
}

const { href = "#", label, class: className = "" } = Astro.props;
---

<a href={href} class:list={["glass-button", className]}>
    <span class="glass-button-inner"></span>
    <span class="glass-button-label">{label}</span>
</a>

<style>
    .glass-button {
        /* Configuración */
        --glass-radius: 9999px;
        --glass-bg: hsla(240, 8%, 68%, 0.082);

        /* Variables dinámicas (JS) */
        --x: 50%;
        --y: 50%;

        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        cursor: pointer;
        padding: 0.15rem 2.4rem; /* Padding original */

        /* GPU acceleration */
        transform: translateZ(0);
        will-change: auto;
    }

    /* 1. EL TEXTO */
    .glass-button-label {
        position: relative;
        z-index: 10;
        color: #101214;
        font-family: var(--font, system-ui, sans-serif);
        font-size: 20px;
        font-weight: 500;
        letter-spacing: 0.02em;
        pointer-events: none;
    }

    /* 2. EL CRISTAL (Cuerpo) */
    .glass-button-inner {
        position: absolute;
        inset: 0;
        border-radius: var(--glass-radius);
        background-color: var(--glass-bg);

        backdrop-filter: blur(0.4rem) saturate(200%);
        -webkit-backdrop-filter: blur(0.4rem) saturate(200%);

        /* SOMBRA SUTIL: He bajado la opacidad de 0.4 a 0.25 para que no sea tan "negra" */
        box-shadow:
            inset 0 0 0.4rem 0.2rem rgba(16, 18, 20, 0.25),
            0 0.8rem 0.8rem rgba(84, 77, 86, 0.05);

        /* Tu animación de entrada */
        animation: jelly-shrink 0.6s ease forwards;
    }

    /* HOVER: Animación de expansión */
    .glass-button:hover .glass-button-inner {
        animation: smooth-expand 0.4s ease forwards;
        /* Al expandirse, la sombra se hace aún más sutil */
        box-shadow:
            inset 0 0 0.4rem 0.2rem rgba(16, 18, 20, 0.15),
            0 0.8rem 0.8rem rgba(84, 77, 86, 0.1);
    }

    /* --- 3. CAPA DE REPULSIÓN (Luz Inversa) --- */
    /* Usamos ::before para la luz que se mueve al contrario */
    .glass-button-inner::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 1px;
        pointer-events: none;

        /* Luz blanca muy suave que se mueve opuesta al mouse */
        background: radial-gradient(
            150px circle at var(--x) var(--y),
            rgba(255, 255, 255, 0.6) 0%,
            transparent 100%
        );

        /* Máscara de borde */
        -webkit-mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;

        opacity: 1; /* Siempre visible, se mueve con JS */
        transition: opacity 0.3s;
    }

    /* --- 4. CAPA ESTÁTICA (Esquinas diagonales) --- */
    /* Usamos ::after para el brillo fijo diagonal "Premium" */
    .glass-button-inner::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 1px;
        pointer-events: none;

        /* Gradiente diagonal fijo: Solo esquinas, centro transparente */
        background: linear-gradient(
            -45deg,
            rgba(255, 255, 255, 0.3) 0%,
            /* Arriba Izq (Sutil) */ rgba(255, 255, 255, 0) 30%,
            /* Transparente rápido */ rgba(255, 255, 255, 0) 70%,
            /* Transparente */ rgba(255, 255, 255, 0.3) 100%
                /* Abajo Der (Sutil) */
        );

        /* Máscara de borde */
        -webkit-mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
    }

    /* Tus Keyframes intactos */
    @keyframes smooth-expand {
        0% {
            transform: perspective(200px) scale(1, 1) rotateX(0deg)
                translateZ(0);
        }
        50% {
            transform: perspective(200px) scale(1.04, 1.2) rotateX(3deg)
                translateZ(8px);
        }
        100% {
            transform: perspective(200px) scale(1.03, 1.15) rotateX(2deg)
                translateZ(5px);
        }
    }

    @keyframes jelly-shrink {
        0% {
            transform: scale(1.03, 1.15);
        }
        25% {
            transform: scale(1.05, 0.9);
        }
        50% {
            transform: scale(0.98, 1.05);
        }
        75% {
            transform: scale(1.01, 0.98);
        }
        100% {
            transform: scale(1, 1);
        }
    }
</style>

<script>
    // Lógica de "Repulsión" (El foco se mueve al lado contrario del mouse)
    function initRepulsionSpotlight() {
        const buttons = document.querySelectorAll(".glass-button");

        buttons.forEach((btn) => {
            const el = btn as HTMLElement;

            el.addEventListener("mousemove", (e) => {
                const rect = el.getBoundingClientRect();

                // Centro del botón
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                // Posición del mouse relativa al botón
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;

                // Calculamos la distancia desde el centro
                const deltaX = mouseX - centerX;
                const deltaY = mouseY - centerY;

                // INVERSIÓN: Restamos el delta al centro en lugar de sumarlo.
                // Multiplicamos por 1.5 para exagerar un poco el movimiento opuesto
                const repulsionX = centerX - deltaX * 1.2;
                const repulsionY = centerY - deltaY * 1.2;

                el.style.setProperty("--x", `${repulsionX}px`);
                el.style.setProperty("--y", `${repulsionY}px`);
            });

            // Al salir, devolvemos la luz al centro suavemente
            el.addEventListener("mouseleave", () => {
                el.style.setProperty("--x", "50%");
                el.style.setProperty("--y", "50%");
            });
        });
    }

    initRepulsionSpotlight();
    document.addEventListener("astro:page-load", initRepulsionSpotlight);
</script>
